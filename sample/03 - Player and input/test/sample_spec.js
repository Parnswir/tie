describe('03 - Player and input', function() {

  it('renders the expected initial output', function() {
    cy.visit('http://localhost:8080/');
    cy.wait(1000);
    cy.document().then((document) => {
      const canvas = document.getElementById('canvas');
      expect(canvas.toDataURL()).to.equal("data:image/png;base64,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");
    });
  });

  it('moves the PC on click', function() {
    cy.visit('http://localhost:8080/');
    cy.wait(1000);

    // set up assertion after movement
    cy.window().then((window) => {
      window.tileEngine.getCharacter('player').on('movementComplete', (event) => {
        cy.document().then((document) => {
          const canvas = document.getElementById('canvas');
          expect(canvas.toDataURL()).to.equal("data:image/png;base64,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");
        });
      });
    });

    // set player in motion
    cy.get('#canvas').click(10, 10);
  });

  it('moves the PC with the keyboard', function() {
    cy.visit('http://localhost:8080/');
    cy.wait(1000);

    // set up assertion after movement
    cy.window().then((window) => {
      window.tileEngine.getCharacter('player').on('movementComplete', (event) => {
        cy.document().then((document) => {
          const canvas = document.getElementById('canvas');
          expect(canvas.toDataURL()).to.equal("data:image/png;base64,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");
        });
      });
    });

    // set player in motion with right arrow key press
    cy.get('#canvas').invoke("trigger", "keypress", 39);
  });
});
